<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- Cron: Kiểm tra công việc quá hạn hàng ngày -->
        <record id="ir_cron_check_overdue_tasks" model="ir.cron">
            <field name="name">Công việc: Kiểm tra quá hạn</field>
            <field name="model_id" ref="model_cong_viec"/>
            <field name="state">code</field>
            <field name="code">model.cron_check_overdue_tasks()</field>
            <field name="interval_number">1</field>
            <field name="interval_type">days</field>
            <field name="numbercall">-1</field>
            <field name="active" eval="True"/>
            <field name="doall" eval="False"/>
            <field name="priority">5</field>
        </record>
        
        <!-- Cron: Nhắc nhở deadline sắp tới -->
        <record id="ir_cron_remind_deadline" model="ir.cron">
            <field name="name">Công việc: Nhắc nhở deadline</field>
            <field name="model_id" ref="model_cong_viec"/>
            <field name="state">code</field>
            <field name="code">model.cron_remind_deadline()</field>
            <field name="interval_number">1</field>
            <field name="interval_type">days</field>
            <field name="numbercall">-1</field>
            <field name="active" eval="True"/>
            <field name="doall" eval="False"/>
            <field name="priority">6</field>
        </record>
        
        <!-- Cron: Tự động chuyển trạng thái công việc đang review quá lâu -->
        <record id="ir_cron_auto_approve_tasks" model="ir.cron">
            <field name="name">Công việc: Tự động duyệt task review quá lâu</field>
            <field name="model_id" ref="model_cong_viec"/>
            <field name="state">code</field>
            <field name="code">
# datetime is available in context
date_limit = datetime.datetime.now() - datetime.timedelta(days=7)
tasks = model.search([
    ('state', '=', 'review'),
    ('write_date', '&lt;=', date_limit)
])

for task in tasks:
    task.message_post(
        body="⚠️ Công việc đã ở trạng thái Review quá 7 ngày. Cần kiểm tra và duyệt.",
        subject="Cảnh báo: Task cần duyệt"
    )
    # Tạo activity cho supervisor
    if task.supervisor_id and task.supervisor_id.user_id:
        task.activity_schedule(
            'mail.mail_activity_data_todo',
            user_id=task.supervisor_id.user_id.id,
            summary='Duyệt công việc: %s' % task.name
        )
            </field>
            <field name="interval_number">1</field>
            <field name="interval_type">days</field>
            <field name="numbercall">-1</field>
            <field name="active" eval="True"/>
            <field name="doall" eval="False"/>
            <field name="priority">8</field>
        </record>
        
        <!-- Cron: Cập nhật thống kê công việc cho nhân viên -->
        <record id="ir_cron_update_employee_statistics" model="ir.cron">
            <field name="name">Công việc: Cập nhật thống kê nhân viên</field>
            <field name="model_id" ref="quan_ly_nhan_su.model_nhan_su"/>
            <field name="state">code</field>
            <field name="code">
# Cập nhật thống kê cho tất cả nhân viên đang làm việc
employees = model.search([('working_status', '=', 'working')])
for employee in employees:
    try:
        employee._compute_task_statistics()
    except Exception as e:
        pass
            </field>
            <field name="interval_number">1</field>
            <field name="interval_type">days</field>
            <field name="numbercall">-1</field>
            <field name="active" eval="True"/>
            <field name="doall" eval="False"/>
            <field name="priority">9</field>
        </record>
        
    </data>
</odoo>
