<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- ========== CATEGORY ========== -->
        <record id="module_category_quan_ly_nhan_su" model="ir.module.category">
            <field name="name">Quản Lý Nhân Sự</field>
            <field name="description">Quản lý nhân sự tùy chỉnh</field>
            <field name="sequence">50</field>
        </record>
        
        <!-- ========== GROUPS ========== -->
        
        <!-- Group 1: Nhân viên thường -->
        <record id="group_nhan_su_employee" model="res.groups">
            <field name="name">Nhân viên</field>
            <field name="category_id" ref="module_category_quan_ly_nhan_su"/>
            <field name="comment">Nhân viên thường - Chỉ xem hồ sơ mình</field>
        </record>
        
        <!-- Group 2: Quản lý -->
        <record id="group_nhan_su_manager" model="res.groups">
            <field name="name">Quản lý</field>
            <field name="category_id" ref="module_category_quan_ly_nhan_su"/>
            <field name="implied_ids" eval="[(4, ref('group_nhan_su_employee'))]"/>
            <field name="comment">Quản lý - Xem nhân viên trong phòng ban</field>
        </record>
        
        <!-- Group 3: Nhân sự -->
        <record id="group_nhan_su_officer" model="res.groups">
            <field name="name">Nhân sự</field>
            <field name="category_id" ref="module_category_quan_ly_nhan_su"/>
            <field name="implied_ids" eval="[(4, ref('group_nhan_su_manager'))]"/>
            <field name="comment">HR - Quản lý toàn bộ nhân sự</field>
        </record>
        
        <!-- Group 4: Admin -->
        <record id="group_nhan_su_admin" model="res.groups">
            <field name="name">Quản trị viên</field>
            <field name="category_id" ref="module_category_quan_ly_nhan_su"/>
            <field name="implied_ids" eval="[(4, ref('group_nhan_su_officer'))]"/>
            <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
            <field name="comment">Admin - Toàn quyền</field>
        </record>
        
        <!-- ========== RECORD RULES - NHAN.SU ========== -->
        
        <!-- Rule 1: Nhân viên - Chỉ xem hồ sơ mình -->
        <record id="nhan_su_rule_employee" model="ir.rule">
            <field name="name">Nhân viên: Chỉ xem hồ sơ mình</field>
            <field name="model_id" ref="model_nhan_su"/>
            <field name="domain_force">[('user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_nhan_su_employee'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Rule 2: Quản lý - Xem nhân viên trong phòng ban -->
        <record id="nhan_su_rule_manager" model="ir.rule">
            <field name="name">Quản lý: Nhân viên trong phòng ban</field>
            <field name="model_id" ref="model_nhan_su"/>
            <field name="domain_force">
                ['|',
                    ('department_id.manager_id.user_id', '=', user.id),
                    ('manager_id.user_id', '=', user.id)
                ]
            </field>
            <field name="groups" eval="[(4, ref('group_nhan_su_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Rule 3: HR Officer - Xem tất cả -->
        <record id="nhan_su_rule_officer" model="ir.rule">
            <field name="name">HR: Tất cả nhân viên</field>
            <field name="model_id" ref="model_nhan_su"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_nhan_su_officer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- ========== RECORD RULES - PHONG.BAN ========== -->
        
        <record id="phong_ban_rule_all" model="ir.rule">
            <field name="name">Phòng ban: Tất cả có thể đọc</field>
            <field name="model_id" ref="model_phong_ban"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_nhan_su_employee'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- ========== RECORD RULES - LICH.SU.DANH.GIA ========== -->
        
        <!-- Rule 1: Nhân viên - Chỉ xem đánh giá của mình -->
        <record id="lich_su_danh_gia_rule_employee" model="ir.rule">
            <field name="name">Nhân viên: Đánh giá của mình</field>
            <field name="model_id" ref="model_lich_su_danh_gia"/>
            <field name="domain_force">[('employee_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_nhan_su_employee'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Rule 2: Quản lý - Xem đánh giá nhân viên quản lý -->
        <record id="lich_su_danh_gia_rule_manager" model="ir.rule">
            <field name="name">Quản lý: Đánh giá nhân viên quản lý</field>
            <field name="model_id" ref="model_lich_su_danh_gia"/>
            <field name="domain_force">
                ['|',
                    ('employee_id.department_id.manager_id.user_id', '=', user.id),
                    ('employee_id.manager_id.user_id', '=', user.id)
                ]
            </field>
            <field name="groups" eval="[(4, ref('group_nhan_su_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Rule 3: HR - Xem tất cả -->
        <record id="lich_su_danh_gia_rule_officer" model="ir.rule">
            <field name="name">HR: Tất cả đánh giá</field>
            <field name="model_id" ref="model_lich_su_danh_gia"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_nhan_su_officer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
    </data>
</odoo>
