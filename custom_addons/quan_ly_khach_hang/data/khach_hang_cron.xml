<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- Cron: Ki·ªÉm tra kh√°ch h√†ng l√¢u kh√¥ng chƒÉm s√≥c -->
        <record id="ir_cron_check_stale_customers" model="ir.cron">
            <field name="name">Kh√°ch h√†ng: Ki·ªÉm tra l√¢u kh√¥ng chƒÉm s√≥c</field>
            <field name="model_id" ref="model_khach_hang"/>
            <field name="state">code</field>
            <field name="code">model.cron_check_stale_customers()</field>
            <field name="interval_number">1</field>
            <field name="interval_type">weeks</field>
            <field name="numbercall">-1</field>
            <field name="active" eval="True"/>
            <field name="doall" eval="False"/>
            <field name="priority">5</field>
        </record>
        
        <!-- Cron: C·∫≠p nh·∫≠t AI Score cho kh√°ch h√†ng -->
        <record id="ir_cron_update_customer_ai_score" model="ir.cron">
            <field name="name">Kh√°ch h√†ng: C·∫≠p nh·∫≠t AI Score</field>
            <field name="model_id" ref="model_khach_hang"/>
            <field name="state">code</field>
            <field name="code">
# C·∫≠p nh·∫≠t AI score cho kh√°ch h√†ng active
customers = model.search([
    ('status', 'in', ['qualified', 'proposal', 'negotiation', 'active'])
])
for customer in customers:
    try:
        customer._compute_ai_customer_score()
    except Exception as e:
        pass
            </field>
            <field name="interval_number">1</field>
            <field name="interval_type">weeks</field>
            <field name="numbercall">-1</field>
            <field name="active" eval="False"/>
            <field name="doall" eval="False"/>
            <field name="priority">10</field>
        </record>
        
        <!-- Cron: C·∫£nh b√°o kh√°ch h√†ng c√≥ nguy c∆° m·∫•t cao -->
        <record id="ir_cron_high_churn_risk_alert" model="ir.cron">
            <field name="name">Kh√°ch h√†ng: C·∫£nh b√°o nguy c∆° m·∫•t cao</field>
            <field name="model_id" ref="model_khach_hang"/>
            <field name="state">code</field>
            <field name="code">
# T√¨m kh√°ch h√†ng c√≥ churn risk > 70%
high_risk_customers = model.search([
    ('status', 'in', ['active', 'negotiation']),
    ('churn_risk', '>', 70)
])

for customer in high_risk_customers:
    customer.message_post(
        body=f"üö® C·∫¢NH B√ÅO: Kh√°ch h√†ng c√≥ nguy c∆° m·∫•t cao ({customer.churn_risk:.0f}%). C·∫ßn h√†nh ƒë·ªông ngay!",
        subject="C·∫£nh b√°o nguy c∆° m·∫•t kh√°ch h√†ng",
        message_type='notification'
    )
    
    # T·∫°o activity cho nh√¢n vi√™n ph·ª• tr√°ch
    for employee in customer.assigned_employee_ids:
        if employee.user_id:
            customer.activity_schedule(
                'mail.mail_activity_data_todo',
                user_id=employee.user_id.id,
                summary=f'ChƒÉm s√≥c kh√°ch h√†ng nguy c∆° cao: {customer.display_name}',
                note=f'Nguy c∆° m·∫•t: {customer.churn_risk:.0f}%'
            )
            </field>
            <field name="interval_number">1</field>
            <field name="interval_type">weeks</field>
            <field name="numbercall">-1</field>
            <field name="active" eval="True"/>
            <field name="doall" eval="False"/>
            <field name="priority">7</field>
        </record>
        
        <!-- Cron: T·ª± ƒë·ªông chuy·ªÉn kh√°ch h√†ng kh√¥ng ho·∫°t ƒë·ªông sang inactive -->
        <record id="ir_cron_auto_inactive_customers" model="ir.cron">
            <field name="name">Kh√°ch h√†ng: T·ª± ƒë·ªông chuy·ªÉn sang Inactive</field>
            <field name="model_id" ref="model_khach_hang"/>
            <field name="state">code</field>
            <field name="code">
# T√¨m kh√°ch h√†ng active nh∆∞ng kh√¥ng c√≥ ho·∫°t ƒë·ªông > 90 ng√†y
inactive_customers = model.search([
    ('status', '=', 'active'),
    ('days_since_last_contact', '>', 90)
])

for customer in inactive_customers:
    customer.write({
        'status': 'inactive',
        'status_reason': 'T·ª± ƒë·ªông chuy·ªÉn do kh√¥ng c√≥ ho·∫°t ƒë·ªông trong 90 ng√†y'
    })
    customer.message_post(
        body="Kh√°ch h√†ng ƒë√£ ƒë∆∞·ª£c chuy·ªÉn sang tr·∫°ng th√°i Inactive do kh√¥ng c√≥ ho·∫°t ƒë·ªông trong 90 ng√†y.",
        subject="Chuy·ªÉn tr·∫°ng th√°i Inactive"
    )
            </field>
            <field name="interval_number">1</field>
            <field name="interval_type">months</field>
            <field name="numbercall">-1</field>
            <field name="active" eval="False"/>
            <field name="doall" eval="False"/>
            <field name="priority">8</field>
        </record>
        
    </data>
</odoo>
