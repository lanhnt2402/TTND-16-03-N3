<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Kanban View -->
        <record id="view_khach_hang_kanban" model="ir.ui.view">
            <field name="name">khach.hang.kanban</field>
            <field name="model">khach.hang</field>
            <field name="arch" type="xml">
                <kanban default_group_by="status" 
                        class="o_kanban_small_column"
                        sample="1"
                        quick_create="false">
                    <field name="id"/>
                    <field name="display_name"/>
                    <field name="customer_type"/>
                    <field name="level"/>
                    <field name="ai_score"/>
                    <field name="ai_score_level"/>
                    <field name="assigned_employee_ids"/>
                    <field name="expected_revenue"/>
                    <field name="activity_ids"/>
                    <field name="activity_state"/>
                    <field name="churn_risk"/>
                    
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <!-- Priority ribbon -->
                                <div class="ribbon ribbon-top-right" t-if="record.level.raw_value == 'vip'">
                                    <span class="bg-danger">VIP</span>
                                </div>
                                
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="display_name"/>
                                        </strong>
                                        <br/>
                                        <span class="text-muted">
                                            <field name="customer_code"/>
                                        </span>
                                    </div>
                                    <div class="o_kanban_record_top_right">
                                        <field name="priority" widget="priority"/>
                                        <field name="activity_ids" widget="kanban_activity"/>
                                    </div>
                                </div>
                                
                                <div class="o_kanban_record_body">
                                    <div class="row">
                                        <div class="col-6">
                                            <span class="badge badge-pill" 
                                                  t-attf-class="badge-{{record.customer_type.raw_value == 'company' ? 'info' : 'secondary'}}">
                                                <field name="customer_type"/>
                                            </span>
                                        </div>
                                        <div class="col-6 text-right">
                                            <span class="badge badge-pill"
                                                  t-attf-class="badge-{{
                                                      record.level.raw_value == 'vip' ? 'danger' :
                                                      record.level.raw_value == 'hot' ? 'warning' :
                                                      record.level.raw_value == 'warm' ? 'info' : 'secondary'
                                                  }}">
                                                <field name="level"/>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-2">
                                        <i class="fa fa-phone"/> <field name="phone"/>
                                    </div>
                                    <div>
                                        <i class="fa fa-envelope"/> <field name="email"/>
                                    </div>
                                    
                                    <div class="mt-2">
                                        <strong>AI Score: </strong>
                                        <field name="ai_score" widget="progressbar"/>
                                    </div>
                                    
                                    <div class="mt-2" t-if="record.churn_risk.raw_value &gt; 50">
                                        <span class="badge badge-danger">
                                            <i class="fa fa-warning"/> Nguy c∆° m·∫•t: <field name="churn_risk"/>%
                                        </span>
                                    </div>
                                    
                                    <div class="mt-2" t-if="record.expected_revenue.raw_value">
                                        <strong>K·ª≥ v·ªçng: </strong>
                                        <field name="expected_revenue" widget="monetary"/>
                                    </div>
                                </div>
                                
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <field name="assigned_employee_ids" widget="many2many_avatar_employee"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <span class="badge badge-pill badge-warning" t-if="record.days_since_last_contact.raw_value &gt; 30">
                                            <i class="fa fa-clock-o"/> <field name="days_since_last_contact"/> ng√†y
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        
        <!-- Tree View -->
        <record id="view_khach_hang_tree" model="ir.ui.view">
            <field name="name">khach.hang.tree</field>
            <field name="model">khach.hang</field>
            <field name="arch" type="xml">
                <tree string="Kh√°ch h√†ng" sample="1"
                      decoration-success="status=='active'"
                      decoration-info="status in ['qualified', 'proposal', 'negotiation']"
                      decoration-warning="status=='contacted'"
                      decoration-danger="status=='lost'">
                    <field name="customer_code"/>
                    <field name="display_name"/>
                    <field name="customer_type"/>
                    <field name="industry"/>
                    <field name="level" widget="badge"
                           decoration-danger="level=='vip'"
                           decoration-warning="level=='hot'"
                           decoration-info="level=='warm'"/>
                    <field name="status" widget="badge"/>
                    <field name="assigned_employee_ids" widget="many2many_tags"/>
                    <field name="ai_score" widget="progressbar"/>
                    <field name="churn_risk" optional="hide"/>
                    <field name="expected_revenue" sum="T·ªïng doanh thu k·ª≥ v·ªçng"/>
                    <field name="probability" widget="percentage" optional="hide"/>
                    <field name="phone"/>
                    <field name="email"/>
                    <field name="days_since_last_contact" optional="hide"/>
                </tree>
            </field>
        </record>
        
        <!-- Form View -->
        <record id="view_khach_hang_form" model="ir.ui.view">
            <field name="name">khach.hang.form</field>
            <field name="model">khach.hang</field>
            <field name="arch" type="xml">
                <form string="Kh√°ch h√†ng">
                    <header>
                        <button name="action_set_contacted" string="ƒê√£ li√™n h·ªá"
                                type="object" class="oe_highlight"
                                attrs="{'invisible': [('status', '!=', 'lead')]}"/>
                        <button name="action_set_qualified" string="ƒê·ªß ƒëi·ªÅu ki·ªán"
                                type="object" class="oe_highlight"
                                attrs="{'invisible': [('status', '!=', 'contacted')]}"/>
                        <button name="action_send_proposal" string="G·ª≠i ƒë·ªÅ xu·∫•t"
                                type="object" class="oe_highlight"
                                attrs="{'invisible': [('status', '!=', 'qualified')]}"/>
                        <button name="action_start_negotiation" string="ƒê√†m ph√°n"
                                type="object" class="oe_highlight"
                                attrs="{'invisible': [('status', '!=', 'proposal')]}"/>
                        <button name="action_set_active" string="K√≠ch ho·∫°t"
                                type="object" class="oe_highlight"
                                attrs="{'invisible': [('status', '!=', 'negotiation')]}"/>
                        <field name="status" widget="statusbar"
                               statusbar_visible="lead,contacted,qualified,proposal,negotiation,active"/>
                    </header>
                    
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_tasks" type="object"
                                    class="oe_stat_button" icon="fa-tasks">
                                <field name="task_count" widget="statinfo" string="C√¥ng vi·ªác"/>
                            </button>
                            <button name="action_view_interactions" type="object"
                                    class="oe_stat_button" icon="fa-comments">
                                <field name="interaction_count" widget="statinfo" string="T∆∞∆°ng t√°c"/>
                            </button>
                            <button name="action_view_assigned_employees" type="object"
                                    class="oe_stat_button" icon="fa-users">
                                <field name="assigned_employee_ids" widget="statinfo" string="Nh√¢n vi√™n"/>
                            </button>
                            <button name="action_create_interaction" type="object"
                                    class="oe_stat_button" icon="fa-plus"
                                    string="T·∫°o t∆∞∆°ng t√°c"/>
                            <button name="action_create_task" type="object"
                                    class="oe_stat_button" icon="fa-plus-square"
                                    string="T·∫°o c√¥ng vi·ªác"/>
                        </div>
                        
                        <widget name="web_ribbon" title="M·∫•t kh√°ch" bg_color="bg-danger"
                                attrs="{'invisible': [('status', '!=', 'lost')]}"/>
                        <widget name="web_ribbon" title="VIP" bg_color="bg-warning"
                                attrs="{'invisible': [('level', '!=', 'vip')]}"/>
                        
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1>
                                <field name="display_name" invisible="1"/>
                                <field name="name" placeholder="T√™n li√™n h·ªá"/>
                            </h1>
                            <h3 attrs="{'invisible': [('customer_type', '!=', 'company')]}">
                                <field name="company_name" placeholder="T√™n c√¥ng ty"
                                       attrs="{'required': [('customer_type', 'in', ['company', 'government'])]}"/>
                            </h3>
                        </div>
                        
                        <group>
                            <group string="Th√¥ng tin c∆° b·∫£n">
                                <field name="customer_code" readonly="1"/>
                                <field name="customer_type"/>
                                <field name="tax_code"
                                       attrs="{'invisible': [('customer_type', 'not in', ['company', 'government'])],
                                               'required': [('customer_type', 'in', ['company', 'government'])]}"/>
                                <field name="registration_number"
                                       attrs="{'invisible': [('customer_type', 'not in', ['company', 'government'])]}"/>
                                <field name="website" widget="url"
                                       attrs="{'invisible': [('customer_type', 'not in', ['company', 'government'])]}"/>
                            </group>
                            <group string="Ph√¢n lo·∫°i">
                                <field name="industry"/>
                                <field name="company_size"
                                       attrs="{'invisible': [('customer_type', 'not in', ['company', 'government'])]}"/>
                                <field name="source"/>
                                <field name="source_detail"/>
                                <field name="level"/>
                                <field name="priority" widget="priority"/>
                            </group>
                        </group>
                        
                        <group>
                            <group string="Li√™n h·ªá">
                                <field name="job_title"
                                       attrs="{'invisible': [('customer_type', '!=', 'company')]}"/>
                                <field name="phone" widget="phone"/>
                                <field name="email" widget="email"/>
                            </group>
                            <group string="Ph√¢n c√¥ng">
                                <field name="assigned_employee_ids" widget="many2many_tags"
                                       options="{'no_create': True}"/>
                                <field name="primary_employee_id" readonly="1"/>
                            </group>
                        </group>
                        
                        <notebook>
                            <!-- Tab 1: ƒê·ªãa ch·ªâ -->
                            <page string="ƒê·ªãa ch·ªâ" name="address">
                                <group>
                                    <group string="ƒê·ªãa ch·ªâ chi ti·∫øt">
                                        <field name="address" placeholder="ƒê·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß"/>
                                        <field name="street"/>
                                        <field name="street2"/>
                                        <field name="city"/>
                                        <field name="state_id"/>
                                        <field name="country_id"/>
                                        <field name="zip_code"/>
                                    </group>
                                </group>
                            </page>
                            
                            <!-- Tab 2: Kinh doanh -->
                            <page string="Th√¥ng tin kinh doanh" name="business">
                                <group>
                                    <group string="Doanh thu">
                                        <field name="currency_id" invisible="1"/>
                                        <field name="annual_revenue" widget="monetary"/>
                                        <field name="expected_revenue" widget="monetary"/>
                                        <field name="probability" widget="percentage"/>
                                    </group>
                                    <group string="Th·ªùi gian">
                                        <field name="first_contact_date"/>
                                        <field name="last_contact_date" readonly="1"/>
                                        <field name="days_since_last_contact" readonly="1"/>
                                    </group>
                                </group>
                                
                                <group string="L√Ω do tr·∫°ng th√°i"
                                       attrs="{'invisible': [('status', 'not in', ['lost', 'inactive'])]}">
                                    <field name="status_reason" nolabel="1" placeholder="Ghi ch√∫ l√Ω do..."/>
                                </group>
                            </page>
                            
                            <!-- Tab 3: AI Analysis -->
                            <page string="Ph√¢n t√≠ch AI" name="ai_analysis">
                                <div class="alert alert-info" role="alert">
                                    <strong>ü§ñ AI Customer Intelligence</strong>
                                    <p>H·ªá th·ªëng ph√¢n t√≠ch ti·ªÅm nƒÉng kh√°ch h√†ng t·ª± ƒë·ªông b·∫±ng AI</p>
                                </div>
                                
                                <group>
                                    <group string="ƒêi·ªÉm AI">
                                        <field name="ai_score" widget="gauge" readonly="1"
                                               options="{'max_value': 100, 'style': 'width:200px; height: 150px;'}"/>
                                        <field name="ai_score_level" widget="badge" readonly="1"
                                               decoration-success="ai_score_level=='very_high'"
                                               decoration-info="ai_score_level=='high'"
                                               decoration-warning="ai_score_level=='medium'"
                                               decoration-danger="ai_score_level in ['low', 'very_low']"/>
                                    </group>
                                    <group string="Nguy c∆°">
                                        <field name="churn_risk" widget="progressbar" readonly="1"/>
                                        <div class="alert alert-danger" role="alert"
                                             attrs="{'invisible': [('churn_risk', '&lt;', 50)]}">
                                            <i class="fa fa-warning"/> <strong>C·∫£nh b√°o:</strong> Nguy c∆° m·∫•t kh√°ch cao!
                                        </div>
                                    </group>
                                </group>
                                
                                <group string="Khuy·∫øn ngh·ªã AI">
                                    <field name="ai_recommendation" nolabel="1" readonly="1"
                                           placeholder="AI s·∫Ω ƒë∆∞a ra khuy·∫øn ngh·ªã khi c√≥ ƒë·ªß d·ªØ li·ªáu..."/>
                                </group>
                            </page>
                            
                            <!-- Tab 4: Ghi ch√∫ -->
                            <page string="Ghi ch√∫" name="note">
                                <field name="note" placeholder="Ghi ch√∫ n·ªôi b·ªô v·ªÅ kh√°ch h√†ng..."/>
                            </page>
                            
                            <!-- Tab 5: T∆∞∆°ng t√°c -->
                            <page string="T∆∞∆°ng t√°c" name="interactions">
                                <field name="interaction_ids" nolabel="1">
                                    <tree>
                                        <field name="interaction_date"/>
                                        <field name="name"/>
                                        <field name="interaction_type"/>
                                        <field name="employee_id"/>
                                        <field name="outcome" widget="badge" decoration-success="outcome == 'positive'" decoration-info="outcome == 'pending'" decoration-danger="outcome == 'negative'"/>
                                        <field name="task_count" widget="statinfo" string="C√¥ng vi·ªác"/>
                                    </tree>
                                    <form>
                                        <sheet>
                                            <group>
                                                <group>
                                                    <field name="customer_id" invisible="1"/>
                                                    <field name="name"/>
                                                    <field name="interaction_type"/>
                                                    <field name="interaction_date"/>
                                                    <field name="employee_id"/>
                                                </group>
                                                <group>
                                                    <field name="duration"/>
                                                    <field name="outcome"/>
                                                    <field name="next_action_date"/>
                                                </group>
                                            </group>
                                            <notebook>
                                                <page string="N·ªôi dung">
                                                    <field name="description"/>
                                                </page>
                                                <page string="H√†nh ƒë·ªông ti·∫øp theo">
                                                    <field name="next_action"/>
                                                </page>
                                                <!-- T·∫°m th·ªùi ·∫©n page n√†y v√¨ task_ids field ch∆∞a ho·∫°t ƒë·ªông (c·∫ßn upgrade module quan_ly_cong_viec) -->
                                                <!-- <page string="C√¥ng vi·ªác ph√°t sinh">
                                                    <field name="task_ids" nolabel="1">
                                                        <tree>
                                                            <field name="task_code"/>
                                                            <field name="name"/>
                                                            <field name="state"/>
                                                            <field name="deadline"/>
                                                        </tree>
                                                    </field>
                                                </page> -->
                                            </notebook>
                                        </sheet>
                                        <chatter/>
                                    </form>
                                </field>
                            </page>
                            
                            <!-- Tab 6: Tags -->
                            <page string="Nh√£n" name="tags">
                                <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                            </page>
                        </notebook>
                        
                        <group>
                            <field name="active" widget="boolean_toggle"/>
                            <field name="company_id" groups="base.group_multi_company"/>
                        </group>
                    </sheet>
                    
                    <!-- Chatter -->
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
        
        <!-- Search View -->
        <record id="view_khach_hang_search" model="ir.ui.view">
            <field name="name">khach.hang.search</field>
            <field name="model">khach.hang</field>
            <field name="arch" type="xml">
                <search string="T√¨m ki·∫øm kh√°ch h√†ng">
                    <field name="name" string="Kh√°ch h√†ng"
                           filter_domain="['|', '|', '|', ('name', 'ilike', self), ('company_name', 'ilike', self), ('customer_code', 'ilike', self), ('email', 'ilike', self)]"/>
                    <field name="assigned_employee_ids"/>
                    <field name="industry"/>
                    <field name="source"/>
                    
                    <filter string="Lead m·ªõi" name="lead"
                            domain="[('status', '=', 'lead')]"/>
                    <filter string="ƒê√£ li√™n h·ªá" name="contacted"
                            domain="[('status', '=', 'contacted')]"/>
                    <filter string="ƒê·ªß ƒëi·ªÅu ki·ªán" name="qualified"
                            domain="[('status', '=', 'qualified')]"/>
                    <filter string="ƒêang ho·∫°t ƒë·ªông" name="active"
                            domain="[('status', '=', 'active')]"/>
                    <filter string="M·∫•t kh√°ch" name="lost"
                            domain="[('status', '=', 'lost')]"/>
                    
                    <separator/>
                    <filter string="VIP" name="vip"
                            domain="[('level', '=', 'vip')]"/>
                    <filter string="N√≥ng" name="hot"
                            domain="[('level', '=', 'hot')]"/>
                    <filter string="·∫§m" name="warm"
                            domain="[('level', '=', 'warm')]"/>
                    
                    <separator/>
                    <filter string="Ti·ªÅm nƒÉng cao (AI)" name="high_potential"
                            domain="[('ai_score', '&gt;=', 60)]"/>
                    <filter string="Nguy c∆° m·∫•t kh√°ch" name="churn_risk"
                            domain="[('churn_risk', '&gt;=', 50)]"/>
                    <filter string="L√¢u ch∆∞a li√™n h·ªá" name="stale"
                            domain="[('days_since_last_contact', '&gt;', 30)]"/>
                    
                    <separator/>
                    <filter string="Doanh nghi·ªáp" name="company"
                            domain="[('customer_type', '=', 'company')]"/>
                    <filter string="C√° nh√¢n" name="individual"
                            domain="[('customer_type', '=', 'individual')]"/>
                    
                    <separator/>
                    <filter string="ƒê√£ l∆∞u tr·ªØ" name="inactive"
                            domain="[('active', '=', False)]"/>
                    
                    <group expand="0" string="Nh√≥m theo">
                        <filter string="Tr·∫°ng th√°i" name="group_status"
                                context="{'group_by': 'status'}"/>
                        <filter string="M·ª©c ƒë·ªô" name="group_level"
                                context="{'group_by': 'level'}"/>
                        <filter string="Lo·∫°i kh√°ch h√†ng" name="group_type"
                                context="{'group_by': 'customer_type'}"/>
                        <filter string="Ng√†nh ngh·ªÅ" name="group_industry"
                                context="{'group_by': 'industry'}"/>
                        <filter string="Ngu·ªìn" name="group_source"
                                context="{'group_by': 'source'}"/>
                        <filter string="Nh√¢n vi√™n ph·ª• tr√°ch" name="group_employee"
                                context="{'group_by': 'primary_employee_id'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <!-- Graph View -->
        <record id="view_khach_hang_graph" model="ir.ui.view">
            <field name="name">khach.hang.graph</field>
            <field name="model">khach.hang</field>
            <field name="arch" type="xml">
                <graph string="Bi·ªÉu ƒë·ªì kh√°ch h√†ng" type="bar" sample="1">
                    <field name="status" type="row"/>
                    <field name="expected_revenue" type="measure"/>
                </graph>
            </field>
        </record>
        
        <!-- Pivot View -->
        <record id="view_khach_hang_pivot" model="ir.ui.view">
            <field name="name">khach.hang.pivot</field>
            <field name="model">khach.hang</field>
            <field name="arch" type="xml">
                <pivot string="Ph√¢n t√≠ch kh√°ch h√†ng" sample="1">
                    <field name="industry" type="row"/>
                    <field name="status" type="col"/>
                    <field name="expected_revenue" type="measure"/>
                    <field name="ai_score" type="measure"/>
                </pivot>
            </field>
        </record>
        
        <!-- Action -->
        <record id="action_khach_hang" model="ir.actions.act_window">
            <field name="name">Kh√°ch h√†ng</field>
            <field name="res_model">khach.hang</field>
            <field name="view_mode">kanban,tree,form,graph,pivot</field>
            <field name="search_view_id" ref="view_khach_hang_search"/>
            <field name="context">{'search_default_active': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    T·∫°o kh√°ch h√†ng m·ªõi
                </p>
                <p>
                    Qu·∫£n l√Ω v√≤ng ƒë·ªùi kh√°ch h√†ng t·ª´ Lead ƒë·∫øn Active.
                    H·ªá th·ªëng t√≠ch h·ª£p AI ph√¢n t√≠ch ti·ªÅm nƒÉng v√† c·∫£nh b√°o nguy c∆° m·∫•t kh√°ch.
                </p>
            </field>
        </record>
        
    </data>
</odoo>
